<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vonage WhatsApp Test - Simple</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen py-8">
    <div class="max-w-md mx-auto bg-white rounded-lg shadow-md p-6">
        <h1 class="text-2xl font-bold text-gray-800 mb-6 text-center">
            üöÄ Vonage WhatsApp Test
        </h1>
        
        <form id="testForm" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                    Dealer ID
                </label>
                <input type="number" id="dealerId" value="1" required
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                    Customer Phone (E.164 format)
                </label>
                <input type="tel" id="customerPhone" value="+393701254950" required
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                       placeholder="+393701254950">
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                    Message
                </label>
                <textarea id="message" rows="3" required
                          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                          placeholder="Enter your test message">Hello from Vonage WhatsApp! This is a test message.</textarea>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                    Language
                </label>
                <select id="language" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="it">Italiano</option>
                    <option value="en">English</option>
                </select>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                    Channel
                </label>
                <select id="channel" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="auto">Auto (WhatsApp ‚Üí SMS)</option>
                    <option value="whatsapp">WhatsApp Only</option>
                    <option value="sms">SMS Only</option>
                </select>
            </div>
            
            <button type="submit" id="sendBtn"
                    class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed">
                Send Test Message
            </button>
        </form>
        
        <div id="result" class="mt-6 hidden">
            <div id="successResult" class="hidden p-4 bg-green-100 border border-green-400 text-green-700 rounded-md">
                <h3 class="font-bold">‚úÖ Success!</h3>
                <p id="successMessage"></p>
            </div>
            
            <div id="errorResult" class="hidden p-4 bg-red-100 border border-red-400 text-red-700 rounded-md">
                <h3 class="font-bold">‚ùå Error!</h3>
                <p id="errorMessage"></p>
            </div>
        </div>
        
        <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-md">
            <h3 class="font-semibold text-blue-800 mb-2">üìã Test Instructions:</h3>
            <ul class="text-sm text-blue-700 space-y-1">
                <li>‚Ä¢ Make sure your phone number is in E.164 format (+393701254950)</li>
                <li>‚Ä¢ For WhatsApp: Join the Vonage sandbox first</li>
                <li>‚Ä¢ Send "join walk crook" to +14157386102 on WhatsApp</li>
                <li>‚Ä¢ Check your phone for the test message</li>
            </ul>
        </div>
    </div>

    <script>
        document.getElementById('testForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const sendBtn = document.getElementById('sendBtn');
            const result = document.getElementById('result');
            const successResult = document.getElementById('successResult');
            const errorResult = document.getElementById('errorResult');
            
            // Disable button and show loading
            sendBtn.disabled = true;
            sendBtn.textContent = 'Sending...';
            
            // Hide previous results
            result.classList.add('hidden');
            successResult.classList.add('hidden');
            errorResult.classList.add('hidden');
            
            try {
                const formData = {
                    dealerId: parseInt(document.getElementById('dealerId').value),
                    customerPhone: document.getElementById('customerPhone').value.trim(),
                    message: document.getElementById('message').value.trim(),
                    language: document.getElementById('language').value,
                    channel: document.getElementById('channel').value
                };
                
                console.log('Sending test request:', formData);
                
                const response = await fetch('/api/test-vonage', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                console.log('Response:', data);
                
                // Show results
                result.classList.remove('hidden');
                
                if (data.success) {
                    successResult.classList.remove('hidden');
                    document.getElementById('successMessage').innerHTML = `
                        <strong>Channel:</strong> ${data.channel}<br>
                        <strong>Message ID:</strong> ${data.messageId || 'N/A'}<br>
                        <strong>Cost:</strong> ‚Ç¨${data.cost || 0}
                    `;
                } else {
                    errorResult.classList.remove('hidden');
                    document.getElementById('errorMessage').textContent = data.error || 'Unknown error occurred';
                }
                
            } catch (error) {
                console.error('Request failed:', error);
                result.classList.remove('hidden');
                errorResult.classList.remove('hidden');
                document.getElementById('errorMessage').textContent = 'Failed to send message.\nError: ' + error.message;
            } finally {
                // Re-enable button
                sendBtn.disabled = false;
                sendBtn.textContent = 'Send Test Message';
            }
        });
    </script>
</body>
</html>
